# 第五章 测试

## 5.1 部署
在进行测试之前，首先需要部署整个系统环境。以下将按步骤叙述从打包、初始化到使用Docker Compose启动所有服务的过程。

### 5.1.1 环境准备与打包
确保本地环境已安装JDK 21、Node.js 20和Docker 24以上版本。
进入项目根目录，运行 `build.sh` 脚本以编译并打包后端Java应用和前端资源。

### 5.1.2 环境初始化
同样在项目根目录下，运行 `init.sh` 脚本，该脚本可能包含了设置Docker相关环境变量或其他初始化操作。

在 `~/appconfig/` 目录下的各个服务配置文件中，需要根据实际情况填充相应的配置项，例如：
- service-sms服务需要配置阿里云短信服务的endpoint、access-key-id、access-key-secret等信息。
- service-oss服务需要配置阿里云OSS的相关参数，如endpoint、access-key-id、access-key-secret以及bucket名称。
- service-order服务需配置支付宝支付网关、应用ID、私钥、公钥和站点域名等支付相关参数。

### 5.1.3 镜像构建
使用Docker Compose v1.29及以上版本，运行 `docker-compose build` 命令构建项目中所有服务的Docker镜像。

### 5.1.4 启动服务
使用 `docker-compose up -d` 命令启动所有服务容器，并以守护态模式运行。

<!--
- **基础设施服务**：
    
    - Nacos：作为注册中心和配置中心运行在8848、9848、9849端口。
    - MySQL：配置了root用户的初始密码，并挂载了初始化SQL脚本、配置文件、日志目录等卷。
    - MongoDB：设置了初始化用户名和密码，并挂载了数据、配置、备份等目录。
    - Redis：挂载了数据目录、配置文件，并开启了AOF持久化和设置了密码保护。
    - RabbitMQ：设置了默认用户和密码，并暴露了AMQP和管理端口。
- **应用服务**：
    
    - 多个微服务（如服务网关、医院服务、用户服务等）均通过Dockerfile构建镜像，并使用环境变量和卷挂载的方式注入配置信息。
    - 前端应用（如网站前端和后台管理界面）也通过Dockerfile构建镜像，并映射端口对外提供服务。
-->


## 5.2 接口测试

### 5.2.1 数据字典
| 接口名称                          | 结果                                                                                                                                                                                                                                   |
| --------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 导入数据字典                      | 当上传一个格式正确且非空的Excel文件时，接口成功导入数据。若上传的文件格式不正确或数据格式不符数据字典项规范，接口响应数据导入失败错误信息。                                                                                            |
| 导出数据字典                      | 调用接口后，成功生成包含所有数据字典项的Excel文件，并以application/octet-stream的内容类型返回资源实体，浏览器能够识别并启动文件下载，文件名为'dict.xlsx'。若在数据读取、处理或文件生成过程中遇到问题时，接口返回数据导出失败错误信息。 |
| 通过ID获取项                      | 输入有效且存在的数据字典ID，接口返回对应的字典项信息；若输入不存在或无效的ID，接口返回空数据。                                                                                                                             |
| 通过父项ID获取子项                | 输入有效且存在父级数据字典ID，接口返回其所有子级字典项信息；若输入不存在或无效的父项ID，接口返回空数据集。                                                                                                                   |
| 通过字典编码获取子项              | 输入有效的数据字典编码，接口返回对应子级字典项信息；若输入无效编码，接口返回空数据。                                                                                                                                                   |
| 通过字典编码获取子项以Map形式返回 | 输入有效的数据字典编码，接口以键值对形式返回对应的子级字典项信息集合；若输入无效编码，接口返回空Map数据结构。                                                                                                                          |
| 通过省市区编码获取省市区名称      | 输入有效的省、市、区编码，接口返回对应的省市区名称列表；若输入无效编码，接口返回空列表。                                                                                                                                               |

### 5.2.2 医院
| 接口名称                                 | 结果 |
| ---------------------------------------- | ---- |
| 新增医院设置                             |
| 修改医院设置                             |
| 删除医院设置                             |
| 批量删除医院设置                         |
| 通过ID获取医院设置                       |
| 条件查询医院设置带分页                   |
| 设置医院状态                             |
| 医院数据统计                             |
| 医院申请加入                             |
| 更新对称加密密钥                         |
| 更新医院信息                             |
| 更新科室信息                             |
| 更新排班信息                             |
| 删除科室信息                             |
| 删除排班信息                             |
| 批量更新科室信息                         |
| 批量更新排班信息                         |
| 批量删除科室信息                         |
| 批量删除排班信息                         |
| 提交订单                                 |
| 更新订单                                 |
| 通过医院名称获取医院列表                 |
| 通过医院编码获取医院                     |
| 条件查询医院带分页                       |
| 通过医院编码获取预约规则                 |
| 通过医院编码获取科室列表                 |
| 通过医院编码和科室编码获取科室           |
| 通过医院编码和科室编码获取排班列表       |
| 分页查询指定医院和科室的排班信息         |
| 通过医院编码、科室编码和工作日期获取排班 |
| 通过ID获取排班详情                       |
| 通过ID获取排班详情（内部调用）           |

### 5.2.3 用户
| 接口名称                     | 结果 |
| ---------------------------- | ---- |
| 新增用户                     |
| 删除用户                     |
| 批量删除用户                 |
| 修改用户                     |
| 设置用户状态                 |
| 通过ID获取用户               |
| 条件查询用户带分页           |
| 用户数据统计                 |
| 登录                         |
| 获取用户基本信息             |
| 获取用户详细信息             |
| 保存实名认证信息             |
| 更新手机号                   |
| 更新昵称                     |
| 获取登陆二维码相关参数       |
| 登录回调                     |
| 获取当前用户添加的所有就诊人 |
| 通过就诊人ID获取就诊人       |
| 移除就诊人                   |
| 添加就诊人                   |
| 修改就诊人                   |
| 通过就诊人ID获取就诊人详情   |

### 5.2.4 短信
| 接口名称   | 结果 |
| ---------- | ---- |
| 发送验证码 |


### 5.2.5 对象存储
| 接口名称        | 结果 |
| --------------- | ---- |
| 获取OSS管理路径 |
| 上传文件        |
| 批量上传文件    |
| 下载文件        |
| 批量下载文件    |
| 删除文件        |
| 批量删除文件    |
| 获取文件列表    |
| 上传文件        |
| 预览文件        |

### 5.2.6 订单
| 接口名称           | 结果 |
| ------------------ | ---- |
| 新增订单           |
| 删除订单           |
| 批量删除订单       |
| 修改订单           |
| 设置订单状态       |
| 通过ID获取订单     |
| 条件查询订单带分页 |
| 订单数据统计       |
| 下单（生成订单）   |
| 通过ID获取订单     |
| 条件查询订单带分页 |
| 取消订单           |
| 获取下单支付页面   |
| 交易查询           |
| 交易关闭           |
| 交易退款           |
| 交易退款查询       |

### 5.2.7 定时任务
| 接口名称     | 结果 |
| ------------ | ---- |
| 发送就诊通知 |
| 更新订单状态 |

### 5.2.8 统计分析
| 接口名称 | 结果 |
| -------- | ---- |
| 医院统计 |
| 用户统计 |
| 订单统计 |


## 5.3 功能测试
<!-- 后台管理员登录、登出
后台管理首页数据展示
数据字典展示、导入导出
医院管理增删改查，状态变更
用户管理增删改查，状态变更
文件上传、下载、删除
订单管理增删改查，状态变更
定时任务：发送就诊通知、更新订单状态
查看统计分析数据（医院、用户、订单）

前台用户登录（手机验证码、微信扫码）、登出
医院列表展示、按等级、地区、名称查询
医院科室、详情展示
科室排班信息展示
预约挂号、创建订单、支付、取消订单
查看、修改个人信息，实名认证
就诊人管理，增删改查
用户讨论区 -->

### 5.3.1 后台管理员登录、登出
| 测试项                                                 | 测试结果 |
| ------------------------------------------------------ | -------- |
| 测试管理员能否通过正确的账号密码登录系统。             | 通过     |
| 测试错误的账号密码组合是否被拒绝登录，并显示相应提示。 | 通过     |
| 测试管理员登出功能是否正常，登出后是否回到登录页面。   | 通过     |

### 5.3.2 后台管理首页数据展示
| 测试项                                                                       | 测试结果 |
| ---------------------------------------------------------------------------- | -------- |
| 测试首页是否能展示预期的各项数据统计，包括但不限于用户数、医院数、订单数等。 | 通过     |
| 测试数据是否实时更新。                                                       | 通过     |

### 5.3.3 数据字典展示、导入导出
| 测试项                                                          | 测试结果 |
| --------------------------------------------------------------- | -------- |
| 测试数据字典项是否能正确展示。                                  | 通过     |
| 测试导入功能是否能正确读取Excel文件，并更新数据字典。           | 通过     |
| 测试导出功能是否能正确生成并下载包含所有数据字典项的Excel文件。 | 通过     |

### 5.3.4 医院管理增删改查，状态变更
| 测试项                                            | 测试结果 |
| ------------------------------------------------- | -------- |
| 测试是否能成功添加、编辑、删除医院信息。          | 通过     |
| 测试医院信息查询功能是否能准确返回搜索结果。      | 通过     |
| 测试医院状态变更功能（如启用/禁用）是否正常工作。 | 通过     |

### 5.3.5 用户管理增删改查，状态变更
| 测试项                                            | 测试结果 |
| ------------------------------------------------- | -------- |
| 测试是否能成功添加、编辑、删除用户信息。          | 通过     |
| 测试用户信息查询功能是否能准确返回搜索结果。      | 通过     |
| 测试用户状态变更功能（如启用/禁用）是否正常工作。 | 通过     |

### 5.3.6 文件上传、下载、删除
| 测试项                                                     | 测试结果 |
| ---------------------------------------------------------- | -------- |
| 测试文件上传功能是否支持各种格式文件，并正确保存到服务器。 | 通过     |
| 测试文件下载功能是否能正确提供下载链接，并保持文件完整性。 | 通过     |
| 测试文件删除功能是否能从服务器删除指定文件。               | 通过     |

### 5.3.7 订单管理增删改查，状态变更
| 测试项                                                 | 测试结果 |
| ------------------------------------------------------ | -------- |
| 测试是否能成功创建、编辑、删除订单。                   | 通过     |
| 测试订单查询功能是否能准确返回搜索结果。               | 通过     |
| 测试订单状态变更功能（如已支付、已取消）是否正常工作。 | 通过     |

### 5.3.8 定时任务：发送就诊通知、更新订单状态
| 测试项                                 | 测试结果 |
| -------------------------------------- | -------- |
| 测试系统是否能定时发送就诊通知给用户。 | 通过     |
| 测试系统是否能定时更新订单状态。       | 通过     |

### 5.3.9 查看统计分析数据（医院、用户、订单）
| 测试项                                                     | 测试结果 |
| ---------------------------------------------------------- | -------- |
| 测试统计分析页面是否能正确显示医院、用户、订单的统计数据。 | 通过     |
| 测试各项数据是否能按预期的条件进行筛选和分析。             | 通过     |

### 5.3.10 前台用户登录（手机验证码、微信扫码）、登出
| 测试项                                                   | 测试结果 |
| -------------------------------------------------------- | -------- |
| 测试用户能否通过手机验证码登录系统。                     | 通过     |
| 测试微信扫码登录功能是否正常，包括扫码、授权、登录流程。 | 通过     |
| 测试用户登出功能是否正常，登出后是否回到登录页面。       | 通过     |

### 5.3.11 医院列表展示、按等级、地区、名称查询
| 测试项                                               | 测试结果 |
| ---------------------------------------------------- | -------- |
| 测试医院列表是否能正确展示所有医院信息。             | 通过     |
| 测试列表是否支持按医院等级、地区、名称进行筛选查询。 | 通过     |

### 5.3.12 医院科室、详情展示
| 测试项                                                         | 测试结果 |
| -------------------------------------------------------------- | -------- |
| 测试选定医院后是否能正确显示该医院的所有科室信息。             | 通过     |
| 测试医院详情页面是否包含完整的医院信息，包括地址、联系方式等。 | 通过     |

### 5.3.13 科室排班信息展示
| 测试项                                                               | 测试结果 |
| -------------------------------------------------------------------- | -------- |
| 测试选定科室后是否能正确显示该科室的排班信息，包括医生、排班时间等。 | 通过     |

### 5.3.14 预约挂号、创建订单、支付、取消订单
| 测试项                                                 | 测试结果 |
| ------------------------------------------------------ | -------- |
| 测试用户能否成功进行挂号预约，并创建订单。             | 通过     |
| 测试支付功能是否正常，包括支付流程和支付状态更新。     | 通过     |
| 测试用户能否在规定条件下取消订单，并正确更新订单状态。 | 通过     |

### 5.3.15 查看、修改个人信息，实名认证
| 测试项                                                     | 测试结果 |
| ---------------------------------------------------------- | -------- |
| 测试用户能否查看自己的个人信息。                           | 通过     |
| 测试用户能否更新自己的个人信息，包括昵称、手机号等。       | 通过     |
| 测试实名认证功能是否正常，包括提交实名信息和认证状态更新。 | 通过     |

### 5.3.16 就诊人管理，增删改查
| 测试项                                       | 测试结果 |
| -------------------------------------------- | -------- |
| 测试用户能否成功添加、编辑、删除就诊人信息。 | 通过     |
| 测试用户能否查询到已添加的就诊人信息列表。   | 通过     |

### 5.3.17 用户讨论区
| 测试项                                 | 测试结果 |
| -------------------------------------- | -------- |
| 测试用户能否在讨论区发帖、回帖。       | 通过     |
| 测试帖子和回复是否按时间顺序正确显示。 | 通过     |
